{{ ansible_managed | default('# Generated by Ansible') }}

{# Resolve the user to use for SSH config #}
{% set config_user = ssh_config_user | default(pi_user | default('pi')) %}

{# Define ordering of groups for listing hosts #}
{% set groups_order = ssh_config_groups_order | default(['master','zerocluster','picluster','management']) %}

{# Emit a Host block for each inventory host (skip the current host) #}
{% for g in groups_order if groups.get(g) %}
{% for h in groups[g] %}
{% if h != inventory_hostname %}
{% set host_ip = hostvars[h].ipaddr | default(hostvars[h].ansible_host | default(hostvars[h].ansible_default_ipv4.address | default(''))) %}
{% if host_ip %}
Host {{ h }}
    HostName {{ host_ip }}
    User {{ config_user }}

{% endif %}
{% endif %}
{% endfor %}
{% endfor %}
