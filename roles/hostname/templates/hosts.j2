{{ ansible_managed | default('# Generated by Ansible') }}

# Localhost
127.0.0.1   {{ hostname_fqdn_short | default(inventory_hostname) }} localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         {{ hostname_fqdn_short | default(inventory_hostname) }} localhost localhost.localdomain localhost6 localhost6.localdomain6 ip6-localhost ip6-loopback

# IPv6 defaults
fe00::0 ip6-localnet
ff00::0 ip6-mcastprefix
ff02::1 ip6-allnodes
ff02::2 ip6-allrouters

# Primary short hostname mapping (optional 127.0.1.1 pattern used by Debian)
127.0.1.1 {{ hostname_fqdn_short | default(inventory_hostname) }}

# Cluster nodes
{% set ips = [] %}
{% for g in hostname_all_groups_order if groups.get(g) %}
{%   for h in groups[g] %}
{%     set ip = hostvars[h].ipaddr | default(hostvars[h].ansible_host | default(hostvars[h].ansible_default_ipv4.address | default(''))) %}
{%     if ip and (ip not in ips) %}
{%       set _ = ips.append(ip) %}
{%     endif %}
{%   endfor %}
{% endfor %}

{% for ip in ips %}
{# collect all hostnames for this ip, in group order #}
{%   set names = [] %}
{%   for g in hostname_all_groups_order if groups.get(g) %}
{%     for h in groups[g] %}
{%       set hip = hostvars[h].ipaddr | default(hostvars[h].ansible_host | default(hostvars[h].ansible_default_ipv4.address | default(''))) %}
{%       if hip == ip and (h not in names) %}
{%         set _ = names.append(h) %}
{%       endif %}
{%     endfor %}
{%   endfor %}
{{ ip }} {{ names | join(' ') }}
{% endfor %}
